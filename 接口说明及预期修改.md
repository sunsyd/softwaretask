

###### **当前各接口数据格式：**



**前端请求：**

requestBody = { 

​              expression: currentInput.value, //计算式

​              unit: angleUnit.value //弧度制或角度值标志

​            };



**中间层响应请求：**

正常：return jsonify({

​      "success": True,

​      "message": "请求已加入处理队列",

​      "request_id": request_id,

​      "queue_position": request_queue.qsize(),

​      "estimated_wait": request_queue.qsize() * 2

​    }), 202

异常：return jsonify({

​      "success": False,

​      "error": "服务器内部错误",

​      "request_id": "N/A"

​    }), 500



**前端轮询：**

response = await fetch(`http://${ipAddress.value}:8000/calculator/result/${requestId}`);//ID从中间层响应获取



**中间层返回轮询结果：**

无：jsonify({

​        "success": False,

​        "status": "pending",

​        "message": "结果尚未处理完成"

​      })

有：jsonify({

​      "success": True,

​      "status": "completed",

​      "result": result

​    })



**中间层向后端请求计算：**

backend_request_data = {

​          "Expression": req_data["expression"],

​          "Id": request_id,

​          "unit": req_data.get("unit", "deg")

​        }



**中间层解析后端结果：**

result = {

​          "success": True,

​          "data": backend_data["Result"],

​          "request_id": backend_data["Id"],

​          "timestamp": datetime.now().isoformat()

​        }

修改建议：

1.当前后端接口不解析“unit”字段，添加解析

2.当前后端计算异常不返回值，添加异常返回字段“err”